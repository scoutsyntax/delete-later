<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="
           http://maven.apache.org/POM/4.0.0
           http://maven.apache.org/xsd/maven-4.0.0.xsd">

  <modelVersion>4.0.0</modelVersion>

  <groupId>com.example</groupId>
  <artifactId>abc-events-data</artifactId>
  <version>1.0.0</version>
  <packaging>jar</packaging>

  <!-- Optional: drop version from filename -->
  <build>
    <finalName>${project.artifactId}</finalName>

    <plugins>

      <!-- 1) Generate the jar -->
      <!-- MUST appear before antrun plugin -->
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>exec-maven-plugin</artifactId>
        <version>3.1.0</version>
        <executions>
          <execution>
            <id>generate-events-jar</id>
            <phase>package</phase>
            <goals>
              <goal>java</goal>
            </goals>
            <configuration>
              <mainClass>com.example.rules.Main</mainClass>

              <!-- pass through Maven -D properties -->
              <systemProperties>
                <systemProperty>
                  <key>aspen.env</key>
                  <value>${aspen.env}</value>
                </systemProperty>
              </systemProperties>

              <!-- generator must write to target/abc-events.jar -->
              <arguments>
                <argument>${project.build.directory}</argument>
              </arguments>
            </configuration>
          </execution>
        </executions>
      </plugin>

      <!-- 2) Rename generated jar to Maven artifact name -->
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-antrun-plugin</artifactId>
        <version>3.1.0</version>
        <executions>
          <execution>
            <id>rename-generated-jar</id>
            <phase>package</phase>
            <goals>
              <goal>run</goal>
            </goals>
            <configuration>
              <target>
                <echo message="Renaming generated jar to Maven artifact name"/>
                <move
                  file="${project.build.directory}/abc-events.jar"
                  tofile="${project.build.directory}/${project.build.finalName}.jar"
                  overwrite="true"
                  failonerror="true"/>
              </target>
            </configuration>
          </execution>
        </executions>
      </plugin>

    </plugins>
  </build>

</project>
